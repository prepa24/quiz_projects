{% include 'allauth/layouts/base.html' %}
{% load i18n %}

<div class="container py-5">
  {% block content %}
  <div class="card shadow-lg border-0">
    <div class="card-header text-center bg-primary text-white">
      <h3 class="mb-0">
        {% if question.image %}
        <img src="{{ question.image.url }}" alt="{{ question.text }}" class="img-fluid rounded mb-3" style="max-height: 200px;">
        {% endif %}
        {{ question.text|safe }}
      </h3>
    </div>

    <div class="card-body">
      <form method="post" action="{% url 'quiz:submit_answer' %}" content='text/html; charset=UTF-8'>
        {% csrf_token %}
        <input type="hidden" name="question_id" value="{{ question.id }}" />

        <div class="row justify-content-center">
          <div class="col-lg-8 col-md-10 col-sm-12">
            {% for answer in answers %}
            <div class="form-check mb-3">
              <input class="form-check-input" type="radio" name="answer" id="answer{{ forloop.counter }}" value="{{ answer.id }}">
              <label class="form-check-label" for="answer{{ forloop.counter }}">
                {{ answer.text|safe }}
              </label>
            </div>
            {% endfor %}

            {% if has_error %}
            <div class="alert alert-danger mt-3">{% trans "Ou dwe chwazi yon repons anvan ou soumèt." %}</div>
            {% endif %}

            <div class="d-flex justify-content-between mt-4">
              <button class="btn btn-success w-50 me-2" type="submit">{% trans "Soumèt" %}</button>
              <button class="btn btn-outline-secondary w-50" type="submit" name="skip" value="true">{% trans "Sote" %}</button>
            </div>
          </div>
        </div>
      </form>
    </div>

    <div class="card-footer bg-light text-center">
      <div class="d-flex flex-wrap justify-content-center gap-3">
        <span class="badge bg-dark fs-6">⏳ {% trans "Tan ki Rete:" %} <span id="remaining_minutes">{{ remaining_minutes }} {% trans "minit" %}, {{ remaining_seconds }} {% trans "segonn" %}</span></span>
        <span class="badge bg-success fs-6">✅ {% trans "Kesyon ki bon" %} {{ correct_count }}</span>
        <span class="badge bg-danger fs-6">❌ {% trans "Kesyon ki pa bon" %} {{ incorrect_count }}</span>
        <span class="badge bg-warning text-dark fs-6">⏭ {% trans "Kesyon ou skip" %} {{ skipped_count }}</span>
      </div>
    </div>
  </div>

  <script>
    var remainingMinutes = {{ remaining_minutes }};
    var remainingSeconds = {{ remaining_seconds }};

    function updateTime() {
      if (remainingMinutes <= 0 && remainingSeconds <= 0) {
        window.location.href = "{% url 'quiz:time_up' %}";
      } else {
        if (remainingSeconds === 0) {
          if (remainingMinutes > 0) {
            remainingMinutes -= 1;
            remainingSeconds = 59;
          }
        } else {
          remainingSeconds -= 1;
        }
        document.getElementById("remaining_minutes").innerText = remainingMinutes + " minit, " + remainingSeconds + " segonn";
        setTimeout(updateTime, 1000);
      }
    }
    setTimeout(updateTime, 1000);
  </script>
  {% endblock %}
</div>
